<h2><%= @product.name %></h2>
<ul>
  <li>Description: <%= @product.description %></li>
  <li>Price: $<%= @product.price %></li>
  <li> <%= image_tag(@product.image_url) if @product.image? %></li>
  <p>
  <strong>Avg rating:</strong>
  <span id="aggregate_rating">
    <% if @product.reviews.any? %>
      <%= @product.aggregate_rating %>
    <% else %>
      Not have any reviews
    <% end %>
  </span>
</p>
</ul>
<hr>

<h4>Reviews for <%= @product.name %></h4>
<div id ='reviews'>
  <% @product.reviews.order(:updated_at).reverse.each do |review| %>
    <div id= "review_item_<%= review.id %>">
      <p><%= review.user.email %></p>
      <p>Content: <%= review.content %></p>
      <p>Rating: <%= review.rating %></p>
    <ul id="comments_of_review_<%= review.id %>">
      <% review.replies.each do |reply| %>
         <li>
           <p><%= reply.user.email %>: <%= reply.comment %></p>
         </li>
      <% end %>
    </ul>
    <%= render 'replies/form', reply: @reply, review: review %>
    </div>
    <hr>
  <% end %>
</div>

<% if user_signed_in? %>
  <%= render 'reviews/form', review: @review %>
<% end %>
<hr>
<ul class="sub-links">
  <li><%= link_to "Return to products", products_path %></li>
</ul>
